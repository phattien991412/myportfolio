import gsap from "gsap";
import React, { useLayoutEffect, useRef, useState } from "react";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import { MotionPathPlugin } from "gsap/MotionPathPlugin";
import "./index.scss";
import confetti from "canvas-confetti";

gsap.registerPlugin(ScrollTrigger, MotionPathPlugin);
const C4 = () => {
  const c4Ref = useRef();
  const clickRef = useRef();
  const comingRef = useRef();
  const [isComplete, setIsComplete] = useState(false);
  var defaults = {
    spread: 360,
    ticks: 150,
    gravity: 0,
    decay: 0.94,
    startVelocity: 30,
    shapes: ['star'],
    colors: ['FFE400', 'FFBD00', 'E89400', 'FFCA6C', 'FDFFB8']
  };

  function shoot() {
    confetti({
      ...defaults,
      particleCount: 40,
      scalar: 1.2,
      shapes: ['star']
    });
  
    confetti({
      ...defaults,
      particleCount: 10,
      scalar: 0.75,
      shapes: ['circle']
    });
  }

  useLayoutEffect(() => {
    let ctx = gsap.context(() => {
      clickRef.current = gsap
        .timeline({ paused: true })
        .to(".wrap_svg_line", { duration: 2, y: 25, ease: "back" });

      comingRef.current = gsap.to("#rectt", {
        paused: true,
        duration: 10,
        repeat: true,
        repeatDelay: 0,
        yoyo: true,
        ease: "power1.inOut",
        motionPath: {
          path: "#pathh",
          align: "#pathh",
          autoRotate: true,
          alignOrigin: [0.5, 0.5]
        }
      });

      gsap
        .timeline({
          scrollTrigger: {
            trigger: c4Ref.current,
            start: "700% 20%",
            end: "700% 10%",
            // markers: true,
            toggleActions: "play none none reset",
            onLeave: () => setIsComplete(false)
          }
        })
        .to("#rect", {
          duration: 5,
          repeat: false,
          yoyo: true,
          ease: "power1.inOut",
          onComplete: () => {setIsComplete(true); comingRef.current.play(); setTimeout(shoot, 0);
            setTimeout(shoot, 100);
            setTimeout(shoot, 200);},
          onInterrupt: () => setIsComplete(false),
          onStart: () => setIsComplete(false),
          motionPath: {
            path: "#path",
            align: "#path",
            autoRotate: true,
            alignOrigin: [0.5, 0.5]
          }
        });
    }, c4Ref);
    return () => {
      ctx.revert();
      ScrollTrigger.killAll();
    }; // cleanup
  }, []);

  return (
    <div
      ref={c4Ref}
      style={
        isComplete ? { background: "#fff" } : { background: "rgb(0 0 0 / 46%)" }
      }
      className="section_4"
    >
      <div>
        {isComplete && <h3>SOMETHING NEW WILL BE SHOW UP HERE IN FURTHER</h3>}
      </div>
      <div className="wrap_svg">
        <div className="wrap_svg_line">
          {/* <svg
            width="2483"
            height="539"
            viewBox="0 0 5801 3433"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="text-path-container"
          >
            <path
              d="M -17.4829 15.9294 C 297.2 -24.1211 339.25 187.141 393.211 351.93 C 447.171 516.719 617.113 575.553 790.539 486.617 C 963.965 397.68 1095.42 189.366 1488.7 319.17 C 2536 757 1954 -83 3025 76 C 3882 444 3908 -14 4502 19 C 5377 141 5359 623 4810 1828 C 4473 2478 3925 2502 3558 1671"
              stroke="#e77614"
              stroke-width="20"
              id="path"
            ></path>
            <g id="rect" dy="1.5%" y="15px">
              <circle cx="10" cy="10" r="3" fill="#fff" />
            </g>
          </svg> */}
        </div>

        <div className="wrap_svg_bulb">
          <svg
            height="800px"
            width="800px"
            version="1.1"
            id="bulb"
            xmlns="http://www.w3.org/2000/svg"
            xmlnsXlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 503.467 503.467"
            xmlSpace="preserve"
          >
            <g transform="translate(11 1)">
              <path
                style={isComplete ? { fill: "#AAB1BA" } : {}}
                d="M181,395.373c-9.387,0-17.067-7.68-17.067-17.067s7.68-17.067,17.067-17.067h119.467
		c9.387,0,17.067,7.68,17.067,17.067s-7.68,17.067-17.067,17.067c9.387,0,17.067,7.68,17.067,17.067s-7.68,17.067-17.067,17.067
		c9.387,0,17.067,7.68,17.067,17.067s-7.68,17.067-17.067,17.067h-34.133h-51.2H181c-9.387,0-17.067-7.68-17.067-17.067
		s7.68-17.067,17.067-17.067c-9.387,0-17.067-7.68-17.067-17.067S171.613,395.373,181,395.373"
              />
              <path
                style={isComplete ? { fill: "#FFD0A1" } : {}}
                d="M266.333,463.64v17.067c0,9.387-7.68,17.067-17.067,17.067H232.2
		c-9.387,0-17.067-7.68-17.067-17.067V463.64H266.333z"
              />
              <path
                style={isComplete ? { fill: "#F2EDDA" } : {}}
                d="M402.867,164.973c0,68.267-25.6,119.467-85.333,162.133c0,0-17.067,8.533-17.067,34.133H181
		c0-25.6-17.067-34.133-17.067-34.133C104.2,284.44,78.6,233.24,78.6,164.973c0-89.6,72.533-162.133,162.133-162.133
		S402.867,75.373,402.867,164.973L402.867,164.973z"
              />
            </g>
            <path
              style={isComplete ? { fill: "#51565F" } : {}}
              d="M260.267,503.04H243.2c-11.947,0-21.333-9.387-21.333-21.333V464.64c0-2.56,1.707-4.267,4.267-4.267
	h85.333c6.827,0,12.8-5.973,12.8-12.8s-5.973-12.8-12.8-12.8c-2.56,0-4.267-1.707-4.267-4.267c0-2.56,1.707-4.267,4.267-4.267
	c6.827,0,12.8-5.973,12.8-12.8s-5.973-12.8-12.8-12.8c-2.56,0-4.267-1.707-4.267-4.267c0-2.56,1.707-4.267,4.267-4.267
	c6.827,0,12.8-5.973,12.8-12.8c0-6.827-5.973-12.8-12.8-12.8c-2.56,0-4.267-1.707-4.267-4.267c0-28.16,18.773-37.547,19.627-37.547
	c57.173-40.96,82.773-89.6,82.773-158.72c0-87.04-70.827-157.867-157.867-157.867S93.867,78.933,93.867,165.973
	c0,68.267,25.6,117.76,83.627,158.72c0,0,17.067,8.533,18.773,33.28h81.067c2.56,0,4.267,1.707,4.267,4.267
	s-1.707,4.267-4.267,4.267H192c-6.827,0-12.8,5.973-12.8,12.8c0,6.827,5.973,12.8,12.8,12.8h85.333c2.56,0,4.267,1.707,4.267,4.267
	c0,2.56-1.707,4.267-4.267,4.267H192c-6.827,0-12.8,5.973-12.8,12.8s5.973,12.8,12.8,12.8h85.333c2.56,0,4.267,1.707,4.267,4.267
	c0,2.56-1.707,4.267-4.267,4.267H192c-6.827,0-12.8,5.973-12.8,12.8s5.973,12.8,12.8,12.8c2.56,0,4.267,1.707,4.267,4.267
	c0,2.56-1.707,4.267-4.267,4.267c-11.947,0-21.333-9.387-21.333-21.333c0-6.827,3.413-12.8,8.533-17.067
	c-5.12-4.267-8.533-10.24-8.533-17.067s3.413-12.8,8.533-17.067c-5.12-4.267-8.533-10.24-8.533-17.067
	c0-10.24,7.68-18.773,17.067-20.48c-1.707-19.627-13.653-26.453-14.507-26.453c-60.587-43.52-87.893-94.72-87.893-165.547
	c0-92.16,74.24-166.4,166.4-166.4s166.4,74.24,166.4,166.4c0,71.68-26.453,122.88-87.04,165.547
	c-0.853,0.853-13.653,7.68-15.36,26.453c9.387,1.707,17.067,10.24,17.067,20.48c0,6.827-3.413,12.8-8.533,17.067
	c5.12,4.267,8.533,10.24,8.533,17.067s-3.413,12.8-8.533,17.067c5.12,4.267,8.533,10.24,8.533,17.067
	c0,11.947-9.387,21.333-21.333,21.333H281.6v12.8C281.6,493.653,272.213,503.04,260.267,503.04z M230.4,468.907v12.8
	c0,6.827,5.973,12.8,12.8,12.8h17.067c6.827,0,12.8-5.973,12.8-12.8v-12.8H230.4z M277.333,323.84c-2.56,0-4.267-1.707-4.267-4.267
	V195.84H230.4v123.733c0,2.56-1.707,4.267-4.267,4.267s-4.267-1.707-4.267-4.267V195.84H192c-21.333,0-38.4-17.067-38.4-38.4
	s17.067-38.4,38.4-38.4s38.4,17.067,38.4,38.4v29.867h42.667V157.44c0-21.333,17.067-38.4,38.4-38.4c21.333,0,38.4,17.067,38.4,38.4
	s-17.067,38.4-38.4,38.4H281.6v123.733C281.6,322.133,279.893,323.84,277.333,323.84z M281.6,187.307h29.867
	c16.213,0,29.867-13.653,29.867-29.867s-13.653-29.867-29.867-29.867S281.6,141.227,281.6,157.44V187.307z M192,127.573
	c-16.213,0-29.867,13.653-29.867,29.867s13.653,29.867,29.867,29.867h29.867V157.44C221.867,141.227,208.213,127.573,192,127.573z
	 M46.933,170.24H4.267c-2.56,0-4.267-1.707-4.267-4.267c0-2.56,1.707-4.267,4.267-4.267h42.667c2.56,0,4.267,1.707,4.267,4.267
	C51.2,168.533,49.493,170.24,46.933,170.24z M499.2,170.24h-42.667c-2.56,0-4.267-1.707-4.267-4.267c0-2.56,1.707-4.267,4.267-4.267
	H499.2c2.56,0,4.267,1.707,4.267,4.267C503.467,168.533,501.76,170.24,499.2,170.24z M58.88,100.267c-0.853,0-0.853,0-1.707,0
	L17.066,85.76c-2.56-0.853-3.413-3.413-2.56-5.12c0.853-2.56,3.413-3.413,5.12-2.56l40.107,14.507c2.56,0.853,3.413,3.413,2.56,5.12
	C62.293,99.413,60.587,100.267,58.88,100.267z M444.587,100.267c-1.707,0-3.413-0.853-4.267-2.56c-0.853-2.56,0-4.267,2.56-5.12
	l40.107-14.507c2.56-0.853,4.267,0,5.12,2.56c0.853,2.56,0,4.267-2.56,5.12l-40.107,14.507
	C445.44,100.267,444.587,100.267,444.587,100.267z M408.747,38.827c-0.853,0-2.56-0.853-3.413-1.707
	c-1.707-1.707-1.707-4.267,0.853-5.973L438.613,3.84c1.707-1.707,4.267-1.707,5.973,0.853c1.707,1.707,1.707,4.267-0.853,5.973
	l-32.427,27.307C410.453,37.973,409.6,38.827,408.747,38.827z M94.72,38.827c-0.853,0-1.707,0-2.56-0.853L59.734,10.667
	C58.027,8.96,58.027,6.4,58.88,4.693c1.707-1.707,4.267-1.707,5.973-0.853L97.28,31.146c1.707,1.707,1.707,4.267,0.853,5.973
	C97.28,37.973,96.427,38.827,94.72,38.827z"
            />
          </svg>
        </div>
      </div>
      <div className="coming_soon">
        <svg
          width="1440"
          height="539"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1440 539"
        >
          <path
            id="pathh"
            d="M-17.4829 15.9294C297.2 -24.1211 339.25 187.141 393.211 351.93C447.171 516.719 617.113 575.553 790.539 486.617C963.965 397.68 1095.42 189.366 1488.7 319.17"
            fill="none"
            stroke="#000"
            strokeWidth="0"
          />
          <g id="rectt">
            <rect width="85" height="30" fill="none" />
            <text x="10" y="19" font-size="20">
              Coming Soon
            </text>
          </g>
        </svg>
      </div>
    </div>
  );
};

export default C4;
